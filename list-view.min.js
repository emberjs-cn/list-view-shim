// ==========================================================================
// Project:   Ember ListView
// Copyright: Â©2012-2013 Erik Bryn, Yapp Inc., and contributors.
// License:   Licensed under MIT license
// ==========================================================================


// Last commit: 1f0c355 (2013-09-18 11:01:11 -0400)


!function(){function t(t,e){return t&&e&&t.x===e.x&&t.y===e.y}function e(){var e,i,r;Ember.instrument("view.updateContext.positionElement",this,function(){e=n(this,"element"),i=n(this,"position"),r=this._position,i&&e&&(t(i,r)||(this._parentView.applyTransform(e,i.x,i.y),this._position=i))},this)}var n=Ember.get;Ember.set,Ember.ListItemViewMixin=Ember.Mixin.create({init:function(){this._super(),this.one("didInsertElement",e)},classNames:["ember-list-item-view"],_position:null,_positionDidChange:Ember.observer(e,"position"),_positionElement:e})}(),function(){function t(t){t.willInsertElement&&t.willInsertElement()}function e(t){t.didInsertElement&&t.didInsertElement()}function n(){var n,s,l,h;n=i(this,"element"),n&&(l=i(this,"context"),this.triggerRecursively("willClearRender"),this.lengthAfterRender>this.lengthBeforeRender&&(this.clearRenderedChildren(),this._childViews.length=this.lengthBeforeRender),l?(s=Ember.RenderBuffer(),s=this.renderToBuffer(s),h=this._childViews.length>0,h&&this.invokeRecursively(t,!1),n.innerHTML=s.innerString?s.innerString():o(s),r(this,"element",n),this.transitionTo("inDOM"),h&&this.invokeRecursively(e,!1)):n.innerHTML="")}var i=Ember.get,r=Ember.set,o=function(t){var e=[],n=t.childBuffers;return Ember.ArrayPolyfills.forEach.call(n,function(t){var n="string"==typeof t;n?e.push(t):t.array(e)}),e.join("")};Ember.ListItemView=Ember.View.extend(Ember.ListItemViewMixin,{updateContext:function(t){var e=i(this,"context");Ember.instrument("view.updateContext.render",this,function(){e!==t&&(this.set("context",t),t instanceof Ember.ObjectController&&this.set("controller",t))},this)},rerender:function(){Ember.run.scheduleOnce("render",this,n)},_contextDidChange:Ember.observer(n,"context","controller")})}(),function(){var t=Ember.get,e=Ember.set;Ember.ReusableListItemView=Ember.View.extend(Ember.ListItemViewMixin,{init:function(){this._super(),this.set("context",Ember.ObjectProxy.create())},isVisible:Ember.computed("context.content",function(){return!!this.get("context.content")}),updateContext:function(n){var i=t(this,"context.content");i!==n&&("inDOM"===this.state&&this.prepareForReuse(n),e(this,"context.content",n))},prepareForReuse:Ember.K})}(),function(){function t(t){if(t in n)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),r=0;r<i.length;r++){var o=i[r]+e;if(o in n)return o}return null}var e=document.createElement("div"),n=e.style,i=["Webkit","Moz","O","ms"],r=t("transform"),o=t("perspective"),s=null!==r,l=null!==o;Ember.ListViewHelper={transformProp:r,applyTransform:function(){return s?function(t,e,n){t.style[r]="translate("+e+"px, "+n+"px)"}:function(t,e,n){t.style.top=n+"px",t.style.left=e+"px"}}(),apply3DTransform:function(){return l?function(t,e,n){t.style[r]="translate3d("+e+"px, "+n+"px, 0)"}:s?function(t,e,n){t.style[r]="translate("+e+"px, "+n+"px)"}:function(t,e,n){t.style.top=n+"px",t.style.left=e+"px"}}()}}(),function(){function t(){var t=s(this,"content");t&&t.addArrayObserver(this)}function e(t){this.removeObject(t),t.destroy()}function n(){Ember.run.once(this,"_syncChildViews")}function i(t,e){return s(t,"contentIndex")-s(e,"contentIndex")}function r(){Ember.View.notifyMutationListeners&&Ember.run.once(Ember.View,"notifyMutationListeners")}function o(){var t,e,n,i;t=s(this,"elementWidth"),e=s(this,"columnCount"),n=t*e,i=this.$(".ember-list-container"),n&&i&&i.css("width",n)}var s=Ember.get,l=Ember.set,h=Math.min,c=Math.max,a=Math.floor,u=Math.ceil,d=Ember.ArrayPolyfills.forEach,m=Ember.create(Ember.ContainerView.proto().domManager);m.prepend=function(t,e){t.$(".ember-list-container").prepend(e),r()},Ember.ListViewMixin=Ember.Mixin.create({itemViewClass:Ember.ListItemView,emptyViewClass:Ember.View,classNames:["ember-list-view"],attributeBindings:["style"],domManager:m,scrollTop:0,bottomPadding:0,_lastEndingIndex:0,paddingCount:1,init:function(){this._super(),this.on("didInsertElement",o),this.columnCountDidChange(),this._syncChildViews(),this._addContentArrayObserver()},_addContentArrayObserver:Ember.beforeObserver(function(){t.call(this)},"content"),render:function(t){t.push('<div class="ember-list-container">'),this._super(t),t.push("</div>")},willInsertElement:function(){if(!this.get("height")||!this.get("rowHeight"))throw"A ListView must be created with a height and a rowHeight.";this._super()},style:Ember.computed("height","width",function(){var t,e,n,i;t=s(this,"height"),e=s(this,"width"),i=s(this,"css"),n="",t&&(n+="height:"+t+"px;"),e&&(n+="width:"+e+"px;");for(var r in i)i.hasOwnProperty(r)&&(n+=r+":"+i[r]+";");return n}),scrollTo:function(){throw"must override to perform the visual scroll and effectively delegate to _scrollContentTo"},_scrollTo:Ember.K,_scrollContentTo:function(t){var e,n,i,r,o,a;a=c(0,t),Ember.instrument("view._scrollContentTo",{scrollTop:a,content:s(this,"content"),startingIndex:this._startingIndex(),endingIndex:h(c(s(this,"content.length")-1,0),this._startingIndex()+this._numChildViewsForViewport())},function(){o=s(this,"content.length"),l(this,"scrollTop",a),r=c(o-1,0),e=this._startingIndex(),i=e+this._numChildViewsForViewport(),n=h(r,i),this.trigger("scrollYChanged",t),(e!==this._lastStartingIndex||n!==this._lastEndingIndex)&&(this._reuseChildren(),this._lastStartingIndex=e,this._lastEndingIndex=n)},this)},totalHeight:Ember.computed("content.length","rowHeight","columnCount","bottomPadding",function(){var t,e,n,i;return t=s(this,"content.length"),e=s(this,"rowHeight"),n=s(this,"columnCount"),i=s(this,"bottomPadding"),u(t/n)*e+i}),_prepareChildForReuse:function(t){t.prepareForReuse()},_reuseChildForContentIndex:function(t,e){var n,i,r,o;n=s(this,"content"),o=s(this,"enableProfiling"),r=this.positionForIndex(e),l(t,"position",r),l(t,"contentIndex",e),o&&Ember.instrument("view._reuseChildForContentIndex",r,function(){},this),i=n.objectAt(e),t.updateContext(i)},positionForIndex:function(t){var e,n,i,r,o,l;return e=s(this,"elementWidth")||1,n=s(this,"width")||1,i=s(this,"columnCount"),r=s(this,"rowHeight"),o=r*a(t/i),l=t%i*e,{y:o,x:l}},_childViewCount:function(){var t,e;return t=s(this,"content.length"),e=this._numChildViewsForViewport(),h(t,e)},columnCount:Ember.computed("width","elementWidth",function(){var t,e,n;return t=s(this,"elementWidth"),e=s(this,"width"),n=t?a(e/t):1}),columnCountDidChange:Ember.observer(function(){var t,e,n,i,r,c,a,u;c=this._lastColumnCount,e=s(this,"scrollTop"),a=s(this,"columnCount"),i=s(this,"maxScrollTop"),u=s(this,"element"),this._lastColumnCount=a,c&&(t=c/a,n=e*t,r=h(i,n),this._scrollTo(r),l(this,"scrollTop",r)),arguments.length>0&&Ember.run.schedule("afterRender",this,o)},"columnCount"),maxScrollTop:Ember.computed("height","totalHeight",function(){var t,e;return t=s(this,"totalHeight"),e=s(this,"height"),c(0,t-e)}),_numChildViewsForViewport:function(){var t,e,n,i;return t=s(this,"height"),e=s(this,"rowHeight"),n=s(this,"paddingCount"),i=s(this,"columnCount"),u(t/e)*i+n*i},_startingIndex:function(){var t,e,n,i,r,o;return r=s(this,"content.length"),t=s(this,"scrollTop"),e=s(this,"rowHeight"),n=s(this,"columnCount"),i=a(t/e)*n,o=c(r-1,0),h(i,o)},contentWillChange:Ember.beforeObserver(function(){var t;t=s(this,"content"),t&&t.removeArrayObserver(this)},"content"),contentDidChange:Ember.observer(function(){t.call(this),n.call(this)},"content"),needsSyncChildViews:Ember.observer(n,"height","width","columnCount"),_addItemView:function(){var t,e;t=s(this,"itemViewClass"),e=this.createChildView(t),this.pushObject(e)},_syncChildViews:function(){var t,n,i,r,o,l,h,c,a;if(!s(this,"isDestroyed")&&!s(this,"isDestroying")){if(n=this._childViewCount(),l=this.positionOrderedChildViews(),t=this._startingIndex(),i=t+n,o=n,r=l.length,c=o-r,0===c);else if(c>0)for(a=this._lastEndingIndex,h=0;c>h;h++,a++)this._addItemView(a);else d.call(l.splice(o,r),e,this);this._scrollContentTo(s(this,"scrollTop")),this._reuseChildren(),this._lastStartingIndex=t,this._lastEndingIndex=this._lastEndingIndex+c}},_reuseChildren:function(){var t,e,n,i,r,o,l,a,u,d,m;for(m=s(this,"scrollTop"),t=s(this,"content.length"),u=c(t-1,0),e=this._childViews,n=e.length,i=this._startingIndex(),a=i+this._numChildViewsForViewport(),r=h(u,a),this.trigger("scrollContentTo",m),d=h(a,i+n),l=i;d>l;l++)o=e[l%n],this._reuseChildForContentIndex(o,l)},positionOrderedChildViews:function(){return this._childViews.sort(i)},arrayWillChange:Ember.K,arrayDidChange:function(t,e){var i,r;"inDOM"===this.state&&((e>=this._lastStartingIndex||e<this._lastEndingIndex)&&(i=0,d.call(this.positionOrderedChildViews(),function(t){r=this._lastStartingIndex+i,this._reuseChildForContentIndex(t,r),i++},this)),n.call(this))}})}(),function(){var t=Ember.get;Ember.set,Ember.ListView=Ember.ContainerView.extend(Ember.ListViewMixin,{css:{position:"relative",overflow:"scroll","-webkit-overflow-scrolling":"touch","overflow-scrolling":"touch"},applyTransform:Ember.ListViewHelper.applyTransform,_scrollTo:function(e){var n=t(this,"element");n&&(n.scrollTop=e)},didInsertElement:function(){var e,n;e=this,n=t(this,"element"),this._updateScrollableHeight(),this._scroll=function(t){e.scroll(t)},Ember.$(n).on("scroll",this._scroll)},willDestroyElement:function(){var e;e=t(this,"element"),Ember.$(e).off("scroll",this._scroll)},scroll:function(t){Ember.run(this,this.scrollTo,t.target.scrollTop)},scrollTo:function(e){t(this,"element"),this._scrollTo(e),this._scrollContentTo(e)},totalHeightDidChange:Ember.observer(function(){Ember.run.scheduleOnce("afterRender",this,this._updateScrollableHeight)},"totalHeight"),_updateScrollableHeight:function(){"inDOM"===this.state&&this.$(".ember-list-container").css({height:t(this,"totalHeight")})}})}(),function(){function t(t){this.mouseWheel(t),t.preventDefault()}function e(t,e){t.addEventListener(u,e.start,!1),t.addEventListener("mousewheel",e.wheel,!1)}function n(t,e){t.removeEventListener(u,e.start,!1),t.removeEventListener("mousewheel",e.wheel,!1)}function i(t){window.addEventListener(d,t.move,!0),window.addEventListener(m,t.end,!0),window.addEventListener(f,t.cancel,!0)}function r(t){window.removeEventListener(d,t.move,!0),window.removeEventListener(m,t.end,!0),window.removeEventListener(f,t.cancel,!0)}function o(t,e){return function(n){e.call(t,n)}}function s(t){var e,n=t.changedTouches[0],i=n.target;return i&&g.test(i.tagName)?(e=document.createEvent("MouseEvents"),e.initMouseEvent("click",!0,!0,t.view,1,n.screenX,n.screenY,n.clientX,n.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),i.dispatchEvent(e)):void 0}var l,h,c,a,u,d,m,f,g=/input|textarea|select/i,p="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch;p?(u="touchstart",l=function(t){var e=t.touches[0],n=e&&e.target;n&&g.test(n.tagName)||(i(this.scrollerEventHandlers),this.willBeginScroll(t.touches,t.timeStamp),t.preventDefault())},d="touchmove",h=function(t){this.continueScroll(t.touches,t.timeStamp)},m="touchend",c=function(t){this._isScrolling||s(t),r(this.scrollerEventHandlers),this.endScroll(t.timeStamp)},f="touchcancel",a=function(t){r(this.scrollerEventHandlers),this.endScroll(t.timeStamp)}):(u="mousedown",l=function(t){if(1===t.which){var e=t.target;e&&g.test(e.tagName)||(i(this.scrollerEventHandlers),this.willBeginScroll([t],t.timeStamp),t.preventDefault())}},d="mousemove",h=function(t){this.continueScroll([t],t.timeStamp)},m="mouseup",c=function(t){r(this.scrollerEventHandlers),this.endScroll(t.timeStamp)},f="mouseout",a=function(t){t.relatedTarget||(r(this.scrollerEventHandlers),this.endScroll(t.timeStamp))}),Ember.VirtualListScrollerEvents=Ember.Mixin.create({init:function(){return this.on("didInsertElement",this,"bindScrollerEvents"),this.on("willDestroyElement",this,"unbindScrollerEvents"),this.scrollerEventHandlers={start:o(this,l),move:o(this,h),end:o(this,c),cancel:o(this,a),wheel:o(this,t)},this._super()},bindScrollerEvents:function(){var t=this.get("element"),n=this.scrollerEventHandlers;e(t,n)},unbindScrollerEvents:function(){var t=this.get("element"),e=this.scrollerEventHandlers;n(t,e),r(e)}})}(),function(){function t(t){var n,i,r;t=t||this,n=e(t,"width"),i=e(t,"height"),r=e(t,"totalHeight"),t.scroller.setDimensions(n,i,n,r),t.trigger("scrollerDimensionsDidChange")}var e=(Math.max,Ember.get);Ember.set,Ember.VirtualListView=Ember.ContainerView.extend(Ember.ListViewMixin,Ember.VirtualListScrollerEvents,{_isScrolling:!1,_mouseWheel:null,css:{position:"relative",overflow:"hidden"},init:function(){this._super(),this.setupScroller()},_scrollerTop:0,applyTransform:Ember.ListViewHelper.apply3DTransform,setupScroller:function(){var e;e=this,e.scroller=new Scroller(function(t,n){"inDOM"===e.state&&e.listContainerElement&&(e.applyTransform(e.listContainerElement,0,-n),e._scrollerTop=n,e._scrollContentTo(n))},{scrollingX:!1,scrollingComplete:function(){e.trigger("scrollingDidComplete")}}),e.trigger("didInitializeScroller"),t(e)},scrollerDimensionsNeedToChange:Ember.observer(function(){Ember.run.once(this,t)},"width","height","totalHeight"),didInsertElement:function(){this.listContainerElement=this.$("> .ember-list-container")[0]},willBeginScroll:function(t,e){this._isScrolling=!1,this.trigger("scrollingDidStart"),this.scroller.doTouchStart(t,e)},continueScroll:function(t,e){var n,i,r;this._isScrolling?this.scroller.doTouchMove(t,e):(n=this._scrollerTop,this.scroller.doTouchMove(t,e),i=this._scrollerTop,n!==i&&(r=Ember.$.Event("scrollerstart"),Ember.$(t[0].target).trigger(r),this._isScrolling=!0))},endScroll:function(t){this.scroller.doTouchEnd(t)},scrollTo:function(t,e){void 0===e&&(e=!0),this.scroller.scrollTo(0,t,e,1)},mouseWheel:function(t){var e,n,i;return e=t.webkitDirectionInvertedFromDevice,n=t.wheelDeltaY*(e?.8:-.8),i=this.scroller.__scrollTop+n,i>=0&&i<=this.scroller.__maxScrollTop&&this.scroller.scrollBy(0,n,!0),!1}})}(),"undefined"==typeof location||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||Ember.Logger.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. If you want full error messages please use the non-minified build provided on the Ember website.");